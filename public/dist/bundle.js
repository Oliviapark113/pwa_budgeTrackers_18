(()=>{let e,t,n,o=[];function a(){let e=o.reduce(((e,t)=>e+parseInt(t.value)),0);document.querySelector("#total").textContent=e}function r(){let e=document.querySelector("#tbody");e.innerHTML="",o.forEach((t=>{let n=document.createElement("tr");n.innerHTML=`\n      <td>${t.name}</td>\n      <td>${t.value}</td>\n    `,e.appendChild(n)}))}function l(){let t=o.slice().reverse(),n=0,a=t.map((e=>{let t=new Date(e.date);return`${t.getMonth()+1}/${t.getDate()}/${t.getFullYear()}`})),r=t.map((e=>(n+=parseInt(e.value),n)));e&&e.destroy();let l=document.getElementById("myChart").getContext("2d");e=new Chart(l,{type:"line",data:{labels:a,datasets:[{label:"Total Over Time",fill:!0,backgroundColor:"#6666ff",data:r}]}})}function c(e){let t=document.querySelector("#t-name"),c=document.querySelector("#t-amount"),u=document.querySelector(".form .error");""!==t.value&&""!==c.value?(u.textContent="",n={name:t.value,value:c.value,date:(new Date).toISOString()},e||(n.value*=-1),o.unshift(n),l(),r(),a(),fetch("/api/transaction",{method:"POST",body:JSON.stringify(n),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.errors?u.textContent="Missing Information":(t.value="",c.value="")})).catch((e=>{e&&console.log(e),d(n),t.value="",c.value=""}))):u.textContent="Missing Information"}fetch("/api/transaction").then((e=>e.json())).then((e=>{o=e,a(),r(),l()})).catch((e=>{console.log(e)}));const u=window.indexedDB.open("BudgetDB",1);function d(e){console.log("transaction",e),t.transaction(["transaction"],"readwrite").objectStore("transaction").add({name:e.name,value:e.value,date:e.date})}u.onerror=e=>console.log(e.target.errorCode),u.onupgradeneeded=e=>{const t=e.target.result;console.log("db0",t),t.createObjectStore("transaction",{keyPath:"id",autoIncrement:!0})},u.onsuccess=e=>{t=e.target.result,console.log(`Sucessfully opened ${t.name}`)},document.querySelector("#add-btn").onclick=function(){c(!0),d(n)},document.querySelector("#sub-btn").onclick=function(){c(!1),d(n)}})();